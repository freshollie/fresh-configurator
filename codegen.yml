overwrite: true

schema:
  - "./packages/*/src/**/{gql,graph}/**/*.ts":
      noRequire: true
  - "!**/__generated__/*.ts"

generates:
  ./packages/api-graph/src/graph/__generated__/index.ts:
    config:
      overwrite: true
      contextType: ../../context#Context
    plugins:
      - typescript
      - typescript-resolvers

  ./schema.graphql:
    plugins:
      - schema-ast
    config:
      includeDirectives: true

  ./packages/configurator/src/gql/__generated__/introspection.json:
    plugins:
      - introspection
    config:
      module: es2015

  ./packages/configurator/src/gql/__generated__/schema.tsx:
    config:
      contextType: ../apollo#ApolloContext
      immutableTypes: true
    plugins:
      - typescript
      - typescript-resolvers

  ./packages/configurator/src/gql/:
    documents:
      - "./packages/configurator/{src,stories}/**/*.{ts,tsx}":
          noRequire: true
      - "!**/__generated__/*.ts"

    preset: near-operation-file
    presetConfig:
      extension: .ts
      baseTypesPath: ./__generated__/schema.tsx
      folder: __generated__
    config:
      nonOptionalTypename: true
      immutableTypes: true
    plugins:
      - typescript-operations
      - typed-document-node

  # compile queries into their hashed values, so that the client
  # only has to ask the server for the hashed query to perform
  # the request
  ./packages/configurator/src/gql/__generated__/persisted-queries-server.json:
    documents:
      - "./packages/configurator/src/**/*.{ts,tsx}":
          noRequire: true
      - "!**/__generated__/*.ts"
      - "!./packages/configurator/src/gql/client.ts"
      - "!./packages/configurator/src/**/*.spec.*"
      - "!./packages/configurator/stories/**/*"
    config:
      output: server
      algorithm: sha256
    plugins:
      - "graphql-codegen-persisted-query-ids"

  # pregenerate the client side persisted query ids, which should
  # match the ones generated by the server
  ./packages/configurator/src/gql/__generated__/persisted-queries.json:
    documents:
      - "./packages/configurator/src/**/*.{ts,tsx}":
          noRequire: true
      - "!**/__generated__/*.ts"
      - "!./packages/configurator/src/gql/client.ts"
      - "!./packages/configurator/src/**/*.spec.*"
      - "!./packages/configurator/stories/**/*"
    config:
      output: client
      algorithm: sha256
    plugins:
      - "graphql-codegen-persisted-query-ids"
